{
    admin off
    auto_https off
}

:{$PORT:80} {
    # Proxy API requests to Go backend (must come first)
    handle /api/* {
        reverse_proxy localhost:8080
    }

    # Serve static files for everything else
    handle {
        root * /srv
        try_files {path} {path}/ /index.html
        file_server
    }

    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        Referrer-Policy strict-origin-when-cross-origin
    }

    encode gzip zstd

    log {
        output stdout
        format console
    }
}
